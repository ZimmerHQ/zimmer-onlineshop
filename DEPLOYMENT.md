# üöÄ Zimmer Project Deployment Guide

This guide covers deploying the Zimmer e-commerce platform to Render using Docker containers.

## üìã Prerequisites

- [Render Account](https://render.com) (free tier available)
- [GitHub Repository](https://github.com) with your code
- OpenAI API key for chatbot functionality
- Telegram Bot Token (optional, for Telegram integration)

## üèóÔ∏è Architecture

The deployment consists of three services:

1. **zimmer-backend** - FastAPI backend API
2. **zimmer-frontend** - Next.js frontend application  
3. **zimmer-db** - PostgreSQL database

## üöÄ Quick Deployment

### 1. Prepare Your Repository

Ensure your repository has the following files:
- `render.yaml` - Render blueprint configuration
- `backend/Dockerfile` - Backend container configuration
- `frontend/Dockerfile` - Frontend container configuration
- `backend/config.py` - Environment configuration
- `backend/main.py` - Updated with proper CORS and health checks

### 2. Deploy to Render

1. **Push to GitHub**: Commit and push all changes to your repository
2. **Create Blueprint**: Go to [Render Dashboard](https://dashboard.render.com) ‚Üí New ‚Üí Blueprint Instance
3. **Connect Repository**: Select your GitHub repository
4. **Configure Environment Variables**:
   - `OPENAI_API_KEY`: Your OpenAI API key
   - `TELEGRAM_BOT_TOKEN`: Your Telegram bot token (if using Telegram)
5. **Deploy**: Click "Create Blueprint Instance"

Render will automatically:
- Create the PostgreSQL database
- Build and deploy the backend service
- Build and deploy the frontend service
- Set up service-to-service communication
- Generate the `TELEGRAM_WEBHOOK_SECRET`

### 3. Post-Deployment Setup

#### Database Migration

After the first deployment, run the database migration:

```bash
# Connect to your backend service shell in Render
# Run the migration command:
python migrate_schema.py
```

#### Telegram Webhook Setup (Optional)

If using Telegram integration, set the webhook:

```bash
# Replace with your actual values from Render dashboard
curl -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/setWebhook" \
  -d "url=$BACKEND_URL/api/telegram/webhook?secret=$TELEGRAM_WEBHOOK_SECRET"
```

## üîß Configuration Details

### Environment Variables

#### Backend Service
- `ENV`: Set to "production" automatically
- `OPENAI_API_KEY`: Your OpenAI API key (manual)
- `TELEGRAM_BOT_TOKEN`: Your Telegram bot token (manual)
- `TELEGRAM_WEBHOOK_SECRET`: Auto-generated by Render
- `FRONTEND_URL`: Automatically set from frontend service
- `DATABASE_URL`: Automatically set from PostgreSQL service

#### Frontend Service
- `NEXT_PUBLIC_API_BASE`: Automatically set from backend service URL

### Health Checks

- **Backend**: `/api/health` - Returns `{"status": "ok"}`
- **Frontend**: `/` - Returns the main page

### Ports

- **Backend**: 8000 (configurable via `$PORT`)
- **Frontend**: 3000 (configurable via `$PORT`)

## üê≥ Docker Configuration

### Backend Container
- Base: `python:3.11-slim`
- Dependencies: `build-essential`, `libpq-dev`
- Security: Non-root user
- Health check: `/api/health` endpoint

### Frontend Container
- Base: `node:20-alpine`
- Multi-stage build for optimization
- Standalone output for production
- Security: Non-root user

## üìä Monitoring & Logs

### Render Dashboard
- Service status and health
- Build logs and deployment history
- Environment variables management
- Service-to-service communication

### Application Logs
- Backend: FastAPI logging with request IDs
- Frontend: Next.js application logs
- Database: PostgreSQL connection logs

## üîÑ Updates & Maintenance

### Automatic Deployments
- Push to main branch triggers automatic deployment
- Blueprint updates require manual redeployment

### Database Backups
- PostgreSQL free tier includes automatic backups
- Backup retention: 7 days

### Scaling
- Free tier: 750 hours/month
- Paid plans: Unlimited hours, custom scaling

## üö® Troubleshooting

### Common Issues

1. **Build Failures**
   - Check Dockerfile syntax
   - Verify requirements.txt dependencies
   - Check build logs in Render dashboard

2. **Database Connection Issues**
   - Verify `DATABASE_URL` is set correctly
   - Check PostgreSQL service status
   - Verify network connectivity between services

3. **CORS Errors**
   - Check `FRONTEND_URL` environment variable
   - Verify CORS configuration in `backend/config.py`
   - Check browser console for specific errors

4. **Health Check Failures**
   - Verify `/api/health` endpoint exists
   - Check application startup logs
   - Verify port configuration

### Debug Commands

```bash
# Check backend logs
render logs zimmer-backend

# Check frontend logs  
render logs zimmer-frontend

# Check database status
render logs zimmer-db

# Connect to backend shell
render shell zimmer-backend

# Check environment variables
render env zimmer-backend
```

## üìö Additional Resources

- [Render Documentation](https://render.com/docs)
- [FastAPI Deployment](https://fastapi.tiangolo.com/deployment/)
- [Next.js Deployment](https://nextjs.org/docs/deployment)
- [PostgreSQL on Render](https://render.com/docs/databases)

## üÜò Support

For deployment issues:
1. Check Render dashboard logs
2. Verify environment variable configuration
3. Test endpoints manually
4. Check service health status
5. Contact Render support if needed

---

**Happy Deploying! üéâ** 